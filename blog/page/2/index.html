
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Virt Block</title>
	<meta name="author" content="Fam Zheng">

	
	<meta name="description" content="Collecting virtual disk use cases in VMware might be helpful to find what kind
of support is valuable or useful to VMDK image in QEMU. So I checked &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Virt Block" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Virt Block</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:famz.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:famz.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/06/07/vmware-virtual-disk-use-cases/">
		
			VMware Virtual Disk Use Cases</a>
	</h2>
	<div class="entry-content">
		<p>Collecting virtual disk use cases in VMware might be helpful to find what kind
of support is valuable or useful to VMDK image in QEMU. So I checked out some
documents today, trying to find something. Besides creating types of disks and
attach them as block device in guest OSes, there are several topics on VMDK
images:</p>


		
		<a href="/blog/2011/06/07/vmware-virtual-disk-use-cases/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-07T01:00:00+08:00" pubdate data-updated="true">Jun 7<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/06/07/vmware-virtual-disk-use-cases//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/06/06/status-update-multi-flat-sparse-support/">
		
			Status Update: Multi Flat/sparse Support</a>
	</h2>
	<div class="entry-content">
		<p>Lately an updated patch set has been posted to list, which is splitted and
improved according to Kevin’s instructions, The patches included <code>monolithicFlat</code>
and <code>monolithicSparse</code> support.</p>


		
		<a href="/blog/2011/06/06/status-update-multi-flat-sparse-support/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-06T01:00:00+08:00" pubdate data-updated="true">Jun 6<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/06/06/status-update-multi-flat-sparse-support//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/06/03/status-update-splitting-patches-for-mono-flat/">
		
			Status Update: Splitting Patches for Mono Flat</a>
	</h2>
	<div class="entry-content">
		<p>The big monolithic flat patch will be split into small ones, I have the split
in mind as:</p>


		
		<a href="/blog/2011/06/03/status-update-splitting-patches-for-mono-flat/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-03T01:00:00+08:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/06/03/status-update-splitting-patches-for-mono-flat//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/06/02/status-update-esx-server-sparse-extent/">
		
			Status Update: ESX Server Sparse Extent</a>
	</h2>
	<div class="entry-content">
		<p>The <strong>ESX Server Sparse Extent</strong> has the same magic number and very similar header
fields, with the existing <code>VMDK3Header</code>. Most code can be reused to add support
for this format. Only a few fields are extra to <code>VMDK3Header</code>, they are used to
save the extent name/description and detect the unclean shutdown.</p>


		
		<a href="/blog/2011/06/02/status-update-esx-server-sparse-extent/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-02T01:00:00+08:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/06/02/status-update-esx-server-sparse-extent//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/31/managing-dev-code-and-patch-series/">
		
			Managing Dev Code and Patch Series</a>
	</h2>
	<div class="entry-content">
		<p>These are notes of chatting with Kevin on managing patch in qemu development.</p>

<blockquote><p>It is a practice that code submitted to qemu are split to small patches, so
that they are easy to review. If the code to submit is long, it will be
difficult to separate at the end of the development. A better approach is to
dev along the will-be series of patch, i.e. when developing a new part create
one commit for each patch that will be submitted in the end. Every commit is a
logical change, if need to adjust anything on it, we can use rebase command of
git.</p>

<p>So the important part to keep handling things easy is that never mix two
logically different things in one commit. Changing commits afterwards, or
merging them is easy, just splitting is hard.</p></blockquote>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-31T01:00:00+08:00" pubdate data-updated="true">May 31<span>st</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/05/31/managing-dev-code-and-patch-series//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/30/patch-monolithic-flat-image-support/">
		
			Patch: Monolithic Flat Image Support</a>
	</h2>
	<div class="entry-content">
		<p>VMDK multiple file images can not be recognized for now. This patch is adding
monolithic flat support to it, that is the image type with two files, one text
descriptor file and a plain data file. This type of image can be created in
VMWare, with the options “allocate all disk space now” and “store virtual disk
as a single file” checked.</p>

<p>A <code>VmdkExtent</code> structure is introduced to hold the image <strong>extent</strong> information,
which makes further adding multi extents support of VMDK easy. An image
creating option “flat” is added for creating flat (preallocated) image.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-30T01:00:00+08:00" pubdate data-updated="true">May 30<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/05/30/patch-monolithic-flat-image-support//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/28/status-update-mono-flat-almost-ready/">
		
			Status Update: Mono Flat Almost Ready</a>
	</h2>
	<div class="entry-content">
		<p>After one week’s work, our mono-flat support is now bound into vmdk. The
support includes <code>probe</code>, <code>open</code>, <code>read</code>, <code>write</code>, <code>is_allocated</code> and also
<code>backing_hd</code> of <code>monolithicFlat</code> type images.</p>


		
		<a href="/blog/2011/05/28/status-update-mono-flat-almost-ready/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-28T01:00:00+08:00" pubdate data-updated="true">May 28<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/05/28/status-update-mono-flat-almost-ready//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/26/status-update-monosparse-is-recovering/">
		
			Status Update: Mono-sparse Is Recovering</a>
	</h2>
	<div class="entry-content">
		<p>So far mono flat support is almost complete, and I’ve started to recover
mono-sparse operations. Open and read are basically back, tomorrow write should
be finished too.</p>

<p>After coding these two formats’ support I’ll turn to build more useful test
suites. The qemu-io commands ‘read’ and ‘write’ might need to be enhanced to
support dump in/out external files, in order to power up auto test scripts.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-26T02:00:00+08:00" pubdate data-updated="true">May 26<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/05/26/status-update-monosparse-is-recovering//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/26/image-disk-size-counted-by-block-driver/">
		
			Preview Image Disk Size Counted by Block Driver</a>
	</h2>
	<div class="entry-content">
		<p>In multiple file vmdk disk, qemu-img info doesn’t count any file allocation
other than descriptor file (the file pointed by <code>bs-&gt;file</code>). A field is added to
BlockDriverState to hold actual disk size if block driver itself has its method
to count the disk size. If the field is not set by block driver, qemu-img will
still query the file size from OS, and ignore the ‘zero’.</p>

<p>The new field is</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int64_t</span> <span class="n">disk_size</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And now used by vmdk driver to pass the sum of file sizes to qemu-img.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-26T01:00:00+08:00" pubdate data-updated="true">May 26<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/05/26/image-disk-size-counted-by-block-driver//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/05/25/status-update-vmdk_open-and-qemu-img-info/">
		
			Status Update: Vmdk open and Qemu-img Info on Multi File Images</a>
	</h2>
	<div class="entry-content">
		<p>The BlockDriver of vmdk is defined as</p>


		
		<a href="/blog/2011/05/25/status-update-vmdk_open-and-qemu-img-info/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-05-25T01:00:00+08:00" pubdate data-updated="true">May 25<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/05/25/status-update-vmdk_open-and-qemu-img-info//blog/page/2/index.html#disqus_thread">Comments</a></div>
	
</div></article>

<nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
        <a href="/blog/page/3/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Fam Zheng

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'Fam';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>