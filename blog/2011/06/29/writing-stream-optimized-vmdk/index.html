
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Writing stream optimized VMDK - Virt Block</title>
	<meta name="author" content="Fam Zheng">

	
	<meta name="description" content="Stream optimized VMDK image allocates minimized space for a compressed cluster,
which means if there is high compress ratio, a cluster possibly only &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Virt Block" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Virt Block</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:famz.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:famz.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Writing Stream Optimized VMDK</h2>
	<div class="entry-content"><p>Stream optimized VMDK image allocates minimized space for a compressed cluster,
which means if there is high compress ratio, a cluster possibly only takes one
physical sector in the file. Which makes overwriting hard, especially when new
data needs more sectors than previously allocated.</p>

<!-- more -->


<p>Attach the image to VMware and boot the VM to test this format, it seems that
VMware wouldnâ€™t do write to allocated clusters, but can allocate new cluster to
save data.</p>

<p>Overwriting existing cluster requires measuring new data size and decide
whether in-place overwrite is OK, if not we must look for other free space.
Metadata in VMDK sparse has no such information for sector allocation
algorithm, so if we want to fully enable writing to stream optimized, sector
allocation bitmap will be introduced into block state. This should
significantly increase memory usage and somehow complicate the driver.</p>

<p>Another approach is to allocate each non-inplace at the end of image and leave
the old allocation unreferenced, which wastes disk space.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-06-29T01:00:00+08:00" pubdate data-updated="true">Jun 29<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gsoc/'>gsoc</a>


</div>
	
		<div class="comments"><a href="/blog/2011/06/29/writing-stream-optimized-vmdk/#disqus_thread">Comments</a></div>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Fam Zheng

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>